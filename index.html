<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AES-GCM –®–∏—Ñ—Ä–∞—Ç–æ—Ä —Å –ê–Ω–∏–º–∞—Ü–∏–µ–π –∏ QR-–∫–æ–¥–æ–º</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
  body {
    margin:0; min-height:100vh; background: linear-gradient(135deg, #667eea, #764ba2);
    font-family: 'Inter', sans-serif; color:#fff; display:flex; flex-direction: column; align-items:center; justify-content:center;
    padding: 20px;
  }
  h1 {
    font-weight: 700; font-size: 2.5rem; margin-bottom: 10px;
    opacity: 0; animation: fadeInDown 1s forwards;
  }
  p.subtitle {
    font-weight: 400; font-size: 1rem; color: #ddd;
    margin-bottom: 30px;
    opacity: 0; animation: fadeInDown 1s 0.3s forwards;
  }
  .container {
    background: rgba(255 255 255 / 0.1);
    border-radius: 12px;
    padding: 30px 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    width: 100%;
    max-width: 460px;
    backdrop-filter: blur(10px);
    opacity: 0; animation: fadeInUp 1s 0.6s forwards;
  }
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
  }
  input[type=text], input[type=password], textarea {
    width: 100%;
    border: none;
    border-radius: 8px;
    padding: 12px 15px;
    margin-bottom: 20px;
    font-size: 1rem;
    font-family: inherit;
    resize: vertical;
    box-sizing: border-box;
  }
  textarea {
    height: 90px;
  }
  input[type=text]:focus, input[type=password]:focus, textarea:focus {
    outline: none;
    box-shadow: 0 0 8px #a29bfe;
  }
  /* –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è –ø–∞—Ä–æ–ª—è —Å –∫–Ω–æ–ø–∫–æ–π */
  .password-wrapper {
    position: relative;
    width: 100%;
  }
  #password {
    padding-right: 40px; /* –º–µ—Å—Ç–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
  }
  .toggle-password {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: #a29bfe;
    font-size: 1.1rem;
    cursor: pointer;
    user-select: none;
    padding: 0;
    line-height: 1;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    transition: background-color 0.2s ease;
  }
  .toggle-password:hover {
    background-color: rgba(255 255 255 / 0.15);
  }
  .toggle-password:focus {
    outline: none;
    box-shadow: 0 0 5px #a29bfe;
  }
  button {
    background: #6c5ce7;
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    padding: 15px;
    cursor: pointer;
    font-size: 1rem;
    width: 48%;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background: #4834d4;
  }
  .buttons {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
  }
  .result {
    background: rgba(255 255 255 / 0.15);
    padding: 20px;
    border-radius: 12px;
    font-family: monospace;
    font-size: 0.9rem;
    color: #dfe6e9;
    white-space: pre-wrap;
    word-break: break-word;
    max-height: 160px;
    overflow-y: auto;
    overflow-x: auto;
    min-height: 90px;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
    position: relative;
  }
  .result.show {
    opacity: 1;
    transform: translateY(0);
  }
  .error {
    color: #ff7675;
    margin-top: -10px;
    margin-bottom: 15px;
    font-weight: 600;
    min-height: 20px;
  }
  /* –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º */
  #copyBtn {
    display: none;
    margin-top: 10px;
    background: #00b894;
    width: 100%;
    border-radius: 8px;
    padding: 10px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    border: none;
  }
  #copyBtn:hover {
    background: #019875;
  }
  /* QR-–∫–æ–¥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
  #qrcode {
    margin-top: 20px;
    display: none;
    text-align: center;
  }
  @keyframes fadeInDown {
    from {opacity: 0; transform: translateY(-15px);}
    to {opacity: 1; transform: translateY(0);}
  }
  @keyframes fadeInUp {
    from {opacity: 0; transform: translateY(15px);}
    to {opacity: 1; transform: translateY(0);}
  }
</style>
</head>
<body>

<div style="text-align:center; margin-bottom: 20px;">
  
</div>
<h1>üîê Text Encryptor</h1>
<p class="subtitle">Enter the message and password to encrypt or decrypt the text</p>

<div class="container">
  <label for="message">‚úâÔ∏è Message / Encrypted text:</label>
  <textarea id="message" placeholder="Enter text here..."></textarea>
  
  <label for="password">üîë Password:</label>
  <div class="password-wrapper">
    <input type="password" id="password" placeholder="Enter password" />
    <button class="toggle-password" aria-label="Show/hide password" title="Show/hide password">üëÅÔ∏è</button>
  </div>
  
  <div class="error" id="error"></div>
  
  <div class="buttons">
    <button id="encryptBtn">Encrypt</button>
    <button id="decryptBtn">Decrypt</button>
  </div>
  
  <div class="result" id="result"></div>
  <button id="copyBtn" title="Copy to clipboard">üìã Copy</button>
  <div id="qrcode"></div>
</div>

<!-- QRCode.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<script>
  // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
  function bufToBase64(buf) {
    return btoa(String.fromCharCode(...new Uint8Array(buf)));
  }
  function base64ToBuf(b64) {
    return Uint8Array.from(atob(b64), c => c.charCodeAt(0));
  }

  // PBKDF2 —Å WebCrypto API
  async function deriveKey(password, salt) {
    const enc = new TextEncoder();
    const keyMaterial = await window.crypto.subtle.importKey(
      'raw',
      enc.encode(password),
      {name: 'PBKDF2'},
      false,
      ['deriveKey']
    );
    return window.crypto.subtle.deriveKey(
      {
        name: 'PBKDF2',
        salt: salt,
        iterations: 100000,
        hash: 'SHA-256'
      },
      keyMaterial,
      { name: 'AES-GCM', length: 256 },
      true,
      ['encrypt', 'decrypt']
    );
  }

  async function encrypt(message, password) {
    const enc = new TextEncoder();
    const salt = window.crypto.getRandomValues(new Uint8Array(16));
    const key = await deriveKey(password, salt);
    const iv = window.crypto.getRandomValues(new Uint8Array(12)); // nonce
    const encodedMessage = enc.encode(message);
    const ciphertext = await window.crypto.subtle.encrypt(
      {name: 'AES-GCM', iv: iv},
      key,
      encodedMessage
    );
    // –ö–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä—É–µ–º salt + iv + ciphertext
    const combined = new Uint8Array(salt.byteLength + iv.byteLength + ciphertext.byteLength);
    combined.set(salt, 0);
    combined.set(iv, salt.byteLength);
    combined.set(new Uint8Array(ciphertext), salt.byteLength + iv.byteLength);
    return bufToBase64(combined);
  }

  async function decrypt(encryptedB64, password) {
    const combined = base64ToBuf(encryptedB64);
    if(combined.length < 16 + 12) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö');

    const salt = combined.slice(0,16);
    const iv = combined.slice(16, 28);
    const ciphertext = combined.slice(28);
    const key = await deriveKey(password, salt);

    const decrypted = await window.crypto.subtle.decrypt(
      {name: 'AES-GCM', iv: iv},
      key,
      ciphertext
    );
    const dec = new TextDecoder();
    return dec.decode(decrypted);
  }

  // UI –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
  const messageEl = document.getElementById('message');
  const passwordEl = document.getElementById('password');
  const togglePasswordBtn = document.querySelector('.toggle-password');
  const resultEl = document.getElementById('result');
  const errorEl = document.getElementById('error');
  const encryptBtn = document.getElementById('encryptBtn');
  const decryptBtn = document.getElementById('decryptBtn');
  const copyBtn = document.getElementById('copyBtn');
  const qrcodeEl = document.getElementById('qrcode');

  // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
  togglePasswordBtn.addEventListener('click', () => {
    if (passwordEl.type === 'password') {
      passwordEl.type = 'text';
      togglePasswordBtn.textContent = 'üôà';
      togglePasswordBtn.title = 'Hide password';
    } else {
      passwordEl.type = 'password';
      togglePasswordBtn.textContent = 'üëÅÔ∏è';
      togglePasswordBtn.title = 'Show password';
    }
  });

  function showResult(text) {
    errorEl.textContent = '';
    resultEl.textContent = text;
    resultEl.classList.add('show');
    copyBtn.style.display = 'block';

    qrcodeEl.style.display = 'block';
    qrcodeEl.innerHTML = '';
    QRCode.toCanvas(text, { width: 160, margin: 2 }).then(canvas => {
      qrcodeEl.appendChild(canvas);
    }).catch(err => {
      console.error(err);
      qrcodeEl.style.display = 'none';
    });
  }
  function showError(text) {
    errorEl.textContent = text;
    resultEl.classList.remove('show');
    resultEl.textContent = '';
    copyBtn.style.display = 'none';
    qrcodeEl.style.display = 'none';
    qrcodeEl.innerHTML = '';
  }

  encryptBtn.onclick = async () => {
    const message = messageEl.value.trim();
    const password = passwordEl.value;
    if (!message) return showError('Enter a message to encrypt.');
    if (!password) return showError('Enter password.');
    try {
      resultEl.classList.remove('show');
      copyBtn.style.display = 'none';
      qrcodeEl.style.display = 'none';
      qrcodeEl.innerHTML = '';
      const encrypted = await encrypt(message, password);
      showResult(encrypted);
    } catch(e) {
      showError('Error while encrypting: ' + e.message);
    }
  };

  decryptBtn.onclick = async () => {
    const encrypted = messageEl.value.trim();
    const password = passwordEl.value;
    if (!encrypted) return showError('Enter encrypted text.');
    if (!password) return showError('Enter password.');
    try {
      resultEl.classList.remove('show');
      copyBtn.style.display = 'none';
      qrcodeEl.style.display = 'none';
      qrcodeEl.innerHTML = '';
      const decrypted = await decrypt(encrypted, password);
      showResult(decrypted);
    } catch(e) {
      showError('Decryption error! Check your password and data.');
    }
  };

  // Copying the result text to the clipboard
  copyBtn.addEventListener('click', () => {
    if (!resultEl.textContent) return;
    navigator.clipboard.writeText(resultEl.textContent).then(() => {
      copyBtn.textContent = '‚úÖ Copied!';
      setTimeout(() => {
        copyBtn.textContent = 'üìã Copy';
      }, 1500);
    }).catch(() => {
      copyBtn.textContent = '‚ùå Error!';
      setTimeout(() => {
        copyBtn.textContent = 'üìã Copy';
      }, 1500);
    });
  });
</script>

</body>
</html>
